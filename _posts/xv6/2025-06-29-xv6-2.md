---
layout: post
title:  "2. 操作系统组织"
category: "xv6-book"
order: "7"

---

对操作系统的关键要求就是它要同时支持多个活动。例如，利用第一章里的 fork 系统调用可以创建新的进程。操作系统就必须在所有进程间对计算机资源进行时间分享（time share）。如果进程的数量多于计算机 CPU 的数量，操作系统就需要确保每个进程都有机会执行。操作系统还必须在进程间进行隔离（isolation），也就是，如果一个进程出现了缺陷和错误，它不能影响到不依赖于这个进程的其他进程。然而，完全的进程隔离过于强了，毕竟进程间也可能需要进行通信，管道流水线就是一个例子。所以一个操作系统要实现三个需求：多路复用、隔离和进程交互。

这一章为操作系统如何实现这三个需求提供了概览。实际上有很多种实现方式，但这本书主要关注宏内核（Monolithic kernel）的主流设计，这也是许多 Unix 操作系统使用的方式。xv6 进程是隔离的基本单元，本章还提供了关于 xv6 进程的概览，以及 xv6 启动时第一个进程的创建过程。

xv6 在多核 RISC-V 微处理器上运行，而且它的许多低级功能（例如进程的实现）是针对 RISC-V 的。RISC-V 是 64 位的 CPU，xv6 是以 "LP64" 的 C 语言编写的。"LP64" 表示 C 语言中的长整数（Long）和指针（Pointer）是 64 位的，而 int 是 32 位的。本书假定读者在一些架构上做过一些机器级的编程，并能够理解 RISC-V 的基本概念。关于 RISC-V 的一个有用的参考是 "The RISC-V Reader: An Open Architecture Atlas"。用户级的指令集架构和特权架构是官方规范。

一个完整的计算机中的 CPU 具有许多支持它的硬件，大多数都是以 I/O 接口的形式存在。xv6 使用 qemu （带有 "-machine virt" 选项）来模拟这些硬件，并为其提供支持。这包括了 RAM（随机存取存储器），一个包含启动代码的 ROM（只读存储器），与用户的键盘/屏幕的连接，以及用于存储的硬盘。

