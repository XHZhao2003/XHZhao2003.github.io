---
layout: post
title:  "2.1 定义关系模式"
category: "数据库"
order: "3"
---

### 定义关系模式

**create table**：使用 create table 命令定义一个表（关系模式），例如：

```sql
create table department
(
    dept_name varchar(20),
    building vatchar(15),
    budget numeric(12, 2),
    primary key (dept_name)
);
```

- 该 SQL 语句创建了 department 表，具有三个列 dept_name, building, budget。
- 括号中的每行表示一个列属性，依次定义它的属性名和域
- varchar(n) 表示长度不超过 n 的字符串，numeric(12, 2) 表示具有 2 位小数和总共 12 位有效数字的数值。其他的基本类型有，char(n) 表示长度固定为 n 的字符串，int 和 smallint 分别表示整数和小整数，float(n) 表示精度至少为 n 的浮点数。每种类型都包含 null 值
- create table 命令还指定了 dept_name 作为 department 关系的主码，这是 department 属性的一个完整性约束
- create table 命令的一般形式就是，首先定义若干个属性，然后定义若干个完整性约束

SQL 支持多种类型的完整性约束，这里只讨论最常用的几个

- primary key (A1,..., An)，定义一组属性作为主码，约束为，主码属性必须非空且唯一。

- foreign key (A1,..., An) refences r，定义一组属性作为参照关系 r 的外键，约束为，这些属性的取值必须对应 r 关系的某个实例的主码的取值。
- not null，这个约束可以直接附加在属性定义的后面，约束为改属性不能取 null 值

SQL 会自动禁止破坏完整性约束的更新。例如，插入元素时，如果主码属性为空值，或者主码属性与已存在的值重复，SQL 就会产生一个错误并停止更新。

下面又定义了几个表，使用了更多的完整性约束

```sql
create table course
(
    course_id    varchar(20),
    title        varchar(50),
    dept_name    varchar(20),
    creadits     numeric(2, 0),
    primary key (course_id),
    foreign key (dept_name) references department
);

create table instructor
(
    ID            varchar(5),
    name          varchar(20) not null,
    dept_name     varchar(20),
    salary        numeric(8, 2),
    primary key (ID),
    foreign key (dept_name) references department
);

create table section
(
    course_id      varchar(8),
    sec_id         varchar(8),
    semester       varchar(6),
    year           numeric(4, 0),
    building       varchar(15),
    room_number    varchar(7),
    time_slot_id   varchar(4),
    primary key (course_id, sec_id, semester, year),
    foreign key (course_id) references course
);

create table teaches
(
    ID              varchar(5),
    course_id       varchar(8),
    sec_id          varchar(8),
    semester        varchar(6),
    year            numeric(4, 0),
	primary key (ID, course_id, sec_id, semester, year),
    foreign key (course_id, sec_id, semester, year) references section,
    foreign key (ID) references instructor
);
```

**drop table**: drop table 命令从数据库中删除关于改关系的所有信息，例如

```sql
drop table students;
```

**alter table**: alter table 命令可以修改现有的关系模式，例如

```sql
alter table r add A D;
alter table r drop A;
```

第一条命令为关系 r 添加了一条属性 A，域为 D。添加后，所有元组在 A 属性上的取值都是 null。第二条命令则删除了该属性。